---
import Layout from '../layouts/Layout.astro';
import { company } from '../data/company';
import ContactForm from '../components/ContactForm.astro';

const success = Astro.url.searchParams.get('success') === '1';

const mapQuery = encodeURIComponent(`${company.address.line1}, ${company.address.postalCode} ${company.address.city}`);
const mapOpenHref = `https://www.google.com/maps/search/?api=1&query=${mapQuery}`;
const mapEmbedSrc = `https://www.google.com/maps?q=${mapQuery}&output=embed`;
---

<Layout title="Kontakt" description="Kontakt aufnehmen – wir melden uns zeitnah zurück.">
	<section class="section">
		<div class="site-container">
			<h1 class="text-3xl font-semibold tracking-tight md:text-4xl">Kontakt</h1>
			<p class="mt-3 max-w-2xl text-sm leading-6 text-[rgb(var(--color-muted))]">
				Wenn Sie ein Neubau- oder Sanierungsvorhaben technisch absichern möchten oder eine konkrete Fragestellung zu Bauphysik und Energieeffizienz haben, melden Sie sich gerne. Wir melden uns zeitnah mit einer fachlichen Einordnung und einem klaren Vorgehen.
			</p>

			{success && (
				<div class="card mt-8 border-[rgb(var(--color-accent))]/30 bg-[rgb(var(--color-accent))]/5 p-6">
					<div class="text-sm font-semibold">Danke – Nachricht wurde gesendet.</div>
					<p class="mt-2 text-sm leading-6 text-[rgb(var(--color-muted))]">
						Wir melden uns so schnell wie möglich zurück.
					</p>
				</div>
			)}

			<div class="mt-10 grid gap-10 lg:grid-cols-2">
				<div class="card p-6 lg:p-8">
					<ContactForm />
					<p class="mt-4 text-xs text-[rgb(var(--color-muted))]">
						Hinweis: Nach dem Senden leitet Formspree optional zurück auf diese Seite.
					</p>
				</div>

				<div>
					<div class="card p-6 lg:p-8">
						<h2 class="text-base font-semibold">Kontaktdaten</h2>
						<div class="mt-4 space-y-3 text-sm text-[rgb(var(--color-muted))]">
							<div>
								<div class="text-xs font-semibold uppercase tracking-wide text-[rgb(var(--color-text))]">
									Firma
								</div>
								<div class="mt-1">{company.name}</div>
							</div>
							<div>
								<div class="text-xs font-semibold uppercase tracking-wide text-[rgb(var(--color-text))]">
									Adresse
								</div>
								<div class="mt-1">
									{company.address.line1}<br />
									{company.address.postalCode} {company.address.city}<br />
									{company.address.country}
								</div>
							</div>
							<div>
								<div class="text-xs font-semibold uppercase tracking-wide text-[rgb(var(--color-text))]">
									Telefon
								</div>
								<div class="mt-1">
									<a class="no-underline hover:opacity-80" href={`tel:${company.contact.phoneHref}`}>
										{company.contact.phonec}
									</a><br>
									<a class="no-underline hover:opacity-80" href={`tel:${company.contact.phoneHref}`}>
										{company.contact.phonec}
									</a>
								</div>
							</div>
							<div>
								<div class="text-xs font-semibold uppercase tracking-wide text-[rgb(var(--color-text))]">
									E-Mail
								</div>
								<div class="mt-1">
									<a class="no-underline hover:opacity-80" href={`mailto:${company.contact.email}`}>
										{company.contact.email}
									</a>
								</div>
							</div>
							<div>
								<div class="text-xs font-semibold uppercase tracking-wide text-[rgb(var(--color-text))]">
									Bürozeiten
								</div>
								<div class="mt-1">{company.contact.officeHours}</div>
							</div>
						</div>
					</div>

<!-- Standort -->
<div class="mt-6 card p-6 lg:p-8">
	<div class="flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between">
		<div>
			<h2 class="text-base font-semibold">Standort</h2>
			<p class="mt-2 text-sm leading-6 text-[rgb(var(--color-muted))]">
				{company.address.line1}, {company.address.postalCode} {company.address.city}
			</p>
		</div>

		<a
			class="btn btn-secondary shrink-0"
			href={mapOpenHref}
			target="_blank"
			rel="noopener noreferrer"
		>
			In Google Maps öffnen
		</a>
	</div>

	<!-- Direkt eingebettet -->
	<div
		class="mt-5 overflow-hidden rounded-xl border bg-[rgb(var(--color-surface))]"
		style="border-color: rgb(var(--color-border) / 0.12);"
	>
		<iframe
			src={mapEmbedSrc}
			title="Google Maps – Standort"
			loading="lazy"
			referrerpolicy="no-referrer-when-downgrade"
			allowfullscreen
			style="border:0; width:100%; height:280px;"
		></iframe>
	</div>

	<!--
	2‑Klick Lösung (später aktivieren)

	<div
		class="mt-5 overflow-hidden rounded-xl border bg-black/5"
		style="border-color: rgb(var(--color-border) / 0.12);"
	>
		<div class="p-5" data-map-consent>
			<div class="text-sm font-semibold">Karte anzeigen</div>
			<p class="mt-1 text-xs leading-5 text-[rgb(var(--color-muted))]">
				Beim Laden der Karte werden Daten an Google übertragen. Weitere Informationen findest du in der Datenschutzerklärung.
			</p>

			<div class="mt-4 flex flex-col gap-2 sm:flex-row">
				<button type="button" class="btn btn-primary" data-map-accept>
					Karte laden
				</button>
				<a class="btn btn-secondary" href={mapOpenHref} target="_blank" rel="noopener noreferrer">
					Route planen
				</a>
			</div>
		</div>

		<div class="hidden" data-map-frame data-src={mapEmbedSrc}></div>
	</div>

	<script is:inline>
		(() => {
			const acceptBtn = document.querySelector('[data-map-accept]');
			const consent = document.querySelector('[data-map-consent]');
			const frameHost = document.querySelector('[data-map-frame]');

			if (!(acceptBtn instanceof HTMLButtonElement)) return;
			if (!(consent instanceof HTMLElement)) return;
			if (!(frameHost instanceof HTMLElement)) return;

			acceptBtn.addEventListener('click', () => {
				if (frameHost.querySelector('iframe')) return;

				const src = frameHost.getAttribute('data-src');
				if (!src) return;

				const iframe = document.createElement('iframe');
				iframe.src = src;
				iframe.title = 'Google Maps – Standort';
				iframe.loading = 'lazy';
				iframe.referrerPolicy = 'no-referrer-when-downgrade';
				iframe.allowFullscreen = true;
				iframe.style.border = '0';
				iframe.style.width = '100%';
				iframe.style.height = '280px';

				consent.classList.add('hidden');
				frameHost.classList.remove('hidden');
				frameHost.appendChild(iframe);
			});
		})();
	</script>
	-->
</div>
				</div>
			</div>
		</div>
	</section>
</Layout>